<h1 id="transaction-format-revision">Transaction Format Revision</h1>

<h2 id="abstract">Abstract</h2>

<p>This CHIP describes a new standard format for transactional information. In contrast to Bitcoin, Chia transactions are split into</p>

<h1 id="notes">NOTES</h1>

<p>sort of getting rid of the WI
replace it with a list of conditions</p>

<h2 id="condition-formats">Condition Formats</h2>

<p>the thing that you sign is (not 100% sure) the concatenation of hashes of all conditions
H(C0 || C1 || C2 … || Ci)</p>

<p>It is normal for the set of conditions to be the same across an entire logical transaction, however, it is not mandatory. Users may vary conditions on a per-input basis.</p>

<h2 id="witness">Witness</h2>

<p>Every witness indirectly references an input, and directly references a list of conditions
Signatures in a witness sign the condition list as above.
It is often the case that all witnesses for a logical tx reference the same list of conditions
AggSig for tx as a whole.</p>

<p>Witnesses have a single byte that gives the witness version.
Initially the pubkeys types listed in outputs are all of the same type:
Reverse BLS 381 pubkey w/ taproot + graftroot
We will allow other types to be softforked in.</p>

<p>If taproot it’s a MAST script. Script has a single byte giving the type.
There is no OP_IF or OP_IFJUMP.</p>

<p>Maybe make OP_ASSERT style opcodes
Maybe make OP_PUSHLOCKTIME or similar</p>

<h3 id="types-of-conditions">Types of conditions:</h3>

<p>Multiple types of coniditions
first byte is type
after that is required values for the condition (fixed length)
optional values (variable length)</p>

<p>If you come across an optional value you don’t understand, then abort success on that condition</p>

<p><em>Specific input</em> – chip must be consumed this block
    req: ID
    opt: amount
    opt: relative locktime</p>

<p><em>Specific output</em> – chip must be created this block
    req: parent
    req: pubkey
    opt: amount</p>

<p><em>Lock time</em> – witness is not valid before a specific time
    req: absolute locktime</p>

<p><em>Precursor input</em> – chip must be consumed this block
    req: ID
    opt: amount
    opt: relative locktime</p>

<p><em>Fee</em>
    req: amount
    opt: salt</p>

<p>Extensible for new conditions</p>

<h3 id="locktime-possible-formats">Locktime possible formats:</h3>
<p>wallclock (timestamp)
block height
VDF iterations</p>

<h3 id="block">Block</h3>

<p>A block is a set of foliage. It has a direct linkage to the current trunk PoSpace. It has a link to the previous foliage block. It has a list of inputs by ID, which are inputs to any transaction, which are spent in this block. It has a list of outputs that are created in this block, which contain a parent, a pubkey, and an amount.</p>

<p>Some parts of the block are prunable: a list of witnesses (which may or may not still have individual IDs), and an aggsig for the whole block</p>
