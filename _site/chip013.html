<h1 id="chip013--taproot-and-graftroot-via-bls-aggregates">chip013 â€“ Taproot and Graftroot via BLS Aggregates</h1>

<h2 id="abstract">Abstract</h2>

<p>Chia will support Taproot for enhanced script privacy and Graftroot for script delegation.</p>

<h2 id="motivation">Motivation</h2>

<h2 id="specification">Specification</h2>

<h3 id="taproot">Taproot</h3>

<p>https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-January/015614.html</p>

<p>Taproot hides a script commitment underneath a public key in a witness script.</p>

<p>Alice and Bob wish to enter into an on-chain contract, enforced by some script, <code class="highlighter-rouge">S</code>.</p>

<p>Alice and Bob will create a new BLS threshold or msig pubkey <code class="highlighter-rouge">C</code>, and store their shares of the private key <code class="highlighter-rouge">c_a</code> and <code class="highlighter-rouge">c_b</code>. <code class="highlighter-rouge">C = g_2^(c_a * c_b)</code>.</p>

<p>Alice and Bob will modify <code class="highlighter-rouge">C</code> to create <code class="highlighter-rouge">P = C * g_2^H(C||S)</code>.</p>

<p>Alice and Bob pay to <code class="highlighter-rouge">P</code>.</p>

<p>Funds may be retrieved via mutual cooperation. Either Alice or Bob must offset their signature by <code class="highlighter-rouge">g_1^H(C||S)</code> after signing the message. Once both parties have signed, the resulting aggregate is multiplied by <code class="highlighter-rouge">g_1^H(C||S)</code> to make a valid signature for <code class="highlighter-rouge">P</code>.</p>

<h1 id="todo-does-this-break-aggregates-weird-factoring-attacks-ask-advisors">TODO: does this break aggregates? Weird factoring attacks? Ask advisors.</h1>

<p>Alternatively, any party that can satisfy the script may publish the script and its arguments.</p>

<p>This means that unless the the script is revealed, its existence is hidden. Outside observers see a single BLS signature. It is indistinguishable from a single-signer account.</p>

<p>Taproot is not limited to two participants. <code class="highlighter-rouge">C</code> may be the public key for an msig or threshold group of any size.</p>

<h3 id="graftroot">Graftroot</h3>

<p>https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-February/015700.html</p>

<p>Graftroot is an extension to taproot, that allows users to delegate the ability to spend an output to a new script.</p>

<p>First a new pubkey is created. This may be a taproot pubkey, <code class="highlighter-rouge">P</code>, or a normal msig or threshold pubkey <code class="highlighter-rouge">C</code>. Should the parties wish to delegate the UTXO, they create a new script <code class="highlighter-rouge">S_1</code> and sign the script such that the signature is valid under <code class="highlighter-rouge">P</code> or <code class="highlighter-rouge">C</code> (as described above). The holder of the delegate script may at any time publish it and its arguments, along with the signature under the pubkey to spend the UTXO.</p>

<p>Note: This delegation is not exclusive. The original participants may still spend by signing a transaction, or by revealing the Taproot script (if any).</p>
