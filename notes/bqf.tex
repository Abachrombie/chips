\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[margin=1.25in]{geometry}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage{dcolumn}
\usepackage{amsmath}
\usepackage{float}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{gauss}
\usepackage{tikz}


\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;} 


\newcommand{\BAR}{
  \hspace{-\arraycolsep}
  \strut\vrule
  \hspace{-\arraycolsep}
}

\graphicspath{ {images/} }

\newcolumntype{2}{D{.}{}{2.0}}

\setlength\parindent{0pt}


\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

\theoremstyle{theorem}
\newtheorem{theorem}{Theorem}[section]

\theoremstyle{example}
\newtheorem{example}{Example}[section]

\theoremstyle{corollary}
\newtheorem{corollary}{Corollary}[section]





\begin{document}



\begin{center}
\LARGE{\textbf{Binary quadratic forms}}
\end{center}



\bigskip
\bigskip
\bigskip




\bigskip

\section{Introduction}

\bigskip

Chia's underlying VDF performs computations within class groups of binary quadratic forms. This handout provides an introduction to binary quadratic forms and to their properties relevant to application in the Chia VDF.

\bigskip

The study of class groups is typically presented either in the context of fractional ideals of algebraic number fields or in the context of binary quadratic forms. The ideal class group of an algebraic number field \(K\) is the quotient group \(J_{K}/P_{K}\), where \(J_{K}\) is the group of fractional ideals of the ring of integers, \(O_{K}\) of \(K\), and \(P_{K}\) is its subgroup of principal fractional ideals. While many feel that this provides a more conceptually intuitive introduction to class groups, the representation of elements of a class group and the implementation of the group operation are best carried out through binary quadratic forms, so this handout will limit its scope to form class groups.

\bigskip

The theorems here will be presented without proof. Please see the References section for proofs and for additional information about class groups and binary quadratic forms.








\bigskip

\section{Background}

\bigskip

Throughout this paper, recall that \(\mathbb{R}\) represents the set of real numbers, \(\mathbb{Z}\) represents the set of integers, and \(\mathbb{Q}\) represents the set of rational numbers.

\bigskip

\theoremstyle{definition}
\begin{definition}[Binary quadratic form]
A binary quadratic form is
\begin{center}
\(f(x, y) = a x^{2} + b x y + c y^{2}\)
\end{center}
where \(a, b, c \in \mathbb{R}\) and \(a, b, c\) are not all equal to zero.
\end{definition}

\bigskip

We write \(f = (a, b, c)\) and call \(f\) a ``form''. These are the objects that we'll be working with throughout this paper.

\bigskip

\theoremstyle{definition}
\begin{definition}[Integral form]
An integral form is a binary quadratic form where \(a, b, c \in \mathbb{Z}\).
\end{definition}

\bigskip

Integral binary quadratic forms are of key importance in algebraic number theory, and they are the relevant forms to the Chia VDF. The remainder of this handout will focus solely on integral forms.

\bigskip

\theoremstyle{definition}
\begin{definition}[Content of a form]
Denoted by \(\textrm{cont}(f)\), the content of a form is
\begin{center}
\(\textrm{cont}(f) = \gcd(a, b, c)\)
\end{center}
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Primitive form]
A form \(f\) is called primitive if \(\textrm{cont}(f) = 1\).
\end{definition}

\bigskip

\subsection{Discriminant}

\bigskip

\theoremstyle{definition}
\begin{definition}[Discriminant]
The discriminant of a form \(f\) is \(\Delta(f) = b^{2} - 4ac\).
\end{definition}

\bigskip

Note that because the square of an integer is always congruent to \(0\) or \(1 \ \textrm{mod} \ 4\), the discriminant of an integral binary quadratic form is always congruent to \(0\) or \(1 \ \textrm{mod} \ 4\).\footnote{Every integer is congruent to \(0\), \(1\), \(2\), or \(3 \ \textrm{mod} \ 4\). Therefore, every square of an integer is congruent to \(0\), \(1\), \(4\), or \(9 \ \textrm{mod} \ 4\), but because \(4\) and \(9\) are congruent to \(0\) and \(1 \ \textrm{mod} \ 4\) respectively, every square is congruent to \(0\) or \(1 \ \textrm{mod} \ 4\).}

\bigskip

Further, any integer which is congruent to \(0\) or \(1 \ \textrm{mod} \ 4\) is the discriminant of a binary quadratic form. This is easy to see by considering the form
\begin{center}
\(\left(1,\ d \ \textrm{mod} \ 4, \frac{(d \ \textrm{mod} \ 4) - d}{4}\right)\)
\end{center}
For \(d \equiv 0\) or \(1 \ \textrm{mod} \ 4\), observe that this form will always be integral, and the discriminant \(\Delta\) of the form is equal to \(d\).

\bigskip

\theoremstyle{theorem}
\begin{theorem}
Given \(\Delta \in \mathbb{Z}\), there is at least one integer binary quadratic form with discriminant \(\Delta\) if and only if \(\Delta \equiv 0\) or \(1 \ \textrm{mod} \ 4\).
\end{theorem}

\bigskip

One can easily check that if \(f = (a, b, c)\) is an integral form, then \(b\) and \(\Delta(f)\) always share the same parity, i.e. \(b \equiv \Delta(f) \ \textrm{mod} \ 2\).

\bigskip

\theoremstyle{definition}
\begin{definition}[Fundamental discriminant]
For \(\Delta \in \mathbb{Z}\), \(\Delta\) is a fundamental discriminant if and only if:
\begin{enumerate}
\item \(\Delta \equiv 1 \ \textrm{mod} \ 4\) and \(\Delta\) is square-free,\footnote{A square-free integer is one which isn't divisible by any perfect squares, i.e. there are no repeated factors in its prime decomposition.} or
\item \(\Delta \equiv 0 \ \textrm{mod} \ 4\), \(\frac{\Delta}{4} \equiv 2, 3 \ \textrm{mod} \ 4\), and \(\frac{\Delta}{4}\) is square-free
\end{enumerate}
\end{definition}

\bigskip

Connecting back to algebraic number fields, fundamental discriminants are exactly those values which are discriminants of quadratic fields.

\bigskip

\theoremstyle{definition}
\begin{definition}[Positive semi-definite binary quadratic form]
A binary form is called positive semi-definite if for any \((x, y) \in \mathbb{R}^{2}\) with \((x, y) \ne (0, 0)\), the value \(f(x, y)\) is non-negative, i.e. \(f(x, y) \ge 0\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Negative semi-definite binary quadratic form]
A binary form is called negative semi-definite if for any \((x, y) \in \mathbb{R}^{2}\) with \((x, y) \ne (0, 0)\), the value \(f(x, y)\) is non-positive, i.e. \(f(x, y) \le 0\).
\end{definition}

\bigskip 

\theoremstyle{definition}
\begin{definition}[Positive definite binary quadratic form]
A binary form is called positive definite if for any \((x, y) \in \mathbb{R}^{2}\) with \((x, y) \ne (0, 0)\), the value \(f(x, y)\) is positive, i.e. \(f(x, y) > 0\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Negative definite binary quadratic form]
A binary form is called negative definite if for any \((x, y) \in \mathbb{R}^{2}\) with \((x, y) \ne (0, 0)\), the value \(f(x, y)\) is negative, i.e. \(f(x, y) < 0\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Indefinite binary quadratic form]
A binary form is called indefinite if for any \((x, y) \in \mathbb{R}^{2}\) with \((x, y) \ne (0, 0)\), the value \(f(x, y)\) takes on both positive and negative values.
\end{definition}

\bigskip

The forms relevant to the Chia VDF are positive definite forms.

\bigskip

\theoremstyle{theorem}
\begin{theorem}
A form \(f\) is positive definite if and only if \(\Delta(f) < 0\) and \(a > 0\).
\end{theorem}







\bigskip

\subsubsection{A quick detour to build intuition about discriminants}

\bigskip

The quantity \(b^{2} - 4ac\) should look familiar. You probably first saw it as the content under the square root in the quadratic formula,
\begin{center}
\(x = \frac{-b \pm \sqrt{b^{2} - 4ac}}{2a}\)
\end{center}

\bigskip

Recall that the quadratic formula helps us solve single-variable quadratic equations that are too difficult to factor, giving the two roots of the associated single-variable quadratic expression. If we set the expression equal to \(y\) and consider the represented curve, the roots are the points in the plane where the curve touches the x-axis.

\bigskip

In the quadratic formula, what happens when \(b^{2} - 4ac = 0\)? The square root reduces to zero, and we're left with \(x = \frac{-b}{2a}\). Hence, there is only one (repeated) root. This is the case in which the graph of the curve grazes the x-axis at just one point. Relative to binary quadratic forms, these discriminants correspond to the extreme case of the semi-definite binary quadratic forms mentioned above.\footnote{Note that the positive and negative semi-definite quadratic forms also include the positive and negative definite forms, respectively.} (See definitions 2.7 and 2.8 and consider the case where \(f(x, y) = 0\).)

\bigskip

When \(b^{2} - 4ac < 0\), however, the quantity under the square root is negative and the roots are complex. Therefore, the curve has no roots on the real x-axis and therefore never crosses it. This gives a curve which is entirely positive or entirely negative. These cases analogously correspond to the definite binary quadratic forms. (See definitions 2.9 and 2.10.)

\bigskip

Finally, when \(b^{2} - 4ac > 0\), two real roots exist, and the curve crosses the x-axis at two points, leading to at least one positive and at least one negative value along the curve. These cases analogously correspond with indefinite binary quadratic forms. (See definition 2.11.)

\bigskip

\begin{figure}[H]
    \centering
    \begin{subfigure}
        \centering
        \includegraphics[height=1.9in]{bqf1}
    \end{subfigure}
    \begin{subfigure}
        \centering
        \includegraphics[height=1.9in]{bqf2}
    \end{subfigure}
    \begin{subfigure}
        \centering
        \includegraphics[height=1.9in]{bqf3}
    \end{subfigure}    
    \caption{Analogous correspondences between binary quadratic forms (purple text) and single-variable quadratic curves (blue and red curves).}
\end{figure}







\bigskip

\subsection{Matrix representations of forms}

\bigskip

\theoremstyle{definition}
\begin{definition}[Matrix of a form]
The matrix of a form \(f = (a, b, c)\) is
\begin{center}
\(M(f) = \begin{bmatrix} a & b/2 \\ b/2 & c \end{bmatrix}\)
\end{center}
with \(\det(M(f)) = ac - \frac{b^{2}}{4}\).
\end{definition}

\bigskip

Using its matrix form, and defining
\begin{center}
\(X = \begin{bmatrix} x & y \end{bmatrix}\)
\end{center}
\(f(x, y)\) can be written as
\begin{center}
\(f(x, y) = X \ M(f) X^{\top} = \begin{bmatrix} x & y \end{bmatrix} \begin{bmatrix} a & b/2 \\ b/2 & c \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix} = a x^{2} + b xy + c y^{2}\)
\end{center}

and we have

\begin{center}
\(\Delta(f) = -4 \ \det(M(f))\).
\end{center}

\bigskip




\subsection{Representation of integers}

\bigskip

Consider the equation
\begin{center}
\(a x^{2} + b x y + c y^{2} = n\)
\end{center}
where \(n \in \mathbb{Z}\) and \(f = (a, b, c)\) is an integral binary quadratic form.

\bigskip

\theoremstyle{definition}
\begin{definition}[A representation of \(n\) by \(f\)]
A solution \((x, y) \in \mathbb{Z}^{2}\) to the above equation for a given \(f\) and \(n\) is called a representation of \(n\) by \(f\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[A proper representation of \(n\) by \(f\)]
A solution \((x, y) \in \mathbb{Z}^{2}\) to the above equation for a given \(f\) and \(n\), such that \(\gcd(x, y) = 1\), is called a proper representation of \(n\) by \(f\).
\end{definition}

\bigskip

Notice that we can restrict our representation considerations to primitive forms. This is because if the content of \(f\) is \(k \ne 1\), i.e. \(gcd(a, b, c) = k\) for some \(k \ne 1\) such that, say, \(a = kA\), \(b = kB\), and \(c = kC\), then we could factor out \(k\) from the lefthand side of the equation, which would mean that \(n\), on the righthand side, is also divisible by \(k\).

\bigskip

\theoremstyle{theorem}
\begin{theorem}
If \(\Delta(f) < 0\) and if \(n \in \mathbb{R}\), then the equation \(ax^{2} + bxy + cy^{2} = n\) has only finitely many solutions, and \(x\) and \(y\) are bounded by
\begin{center}
\(x^{2} \le \frac{4cn}{|\Delta |}\) \quad \quad and \quad \quad \(y^{2} \le \frac{4an}{|\Delta |}\)
\end{center}
\end{theorem}

\bigskip

To find all of the solutions to such an equation where \(\Delta(f) < 0\) and \(n \in \mathbb{R}\), one could test for each solution \((x, y)\) that obeys the constraints given above.

\bigskip

\theoremstyle{example}
\begin{example}
Solve the equation
\begin{center}
\(3x^{2} + 2xy + 2y^{2} = 28\).
\end{center}
Notice that
\begin{center}
\(\Delta(f) = b^{2} - 4ac = 2^{2} - 4(3)(2) = -20 < 0\)
\end{center}
Therefore
\begin{center}
\(x^{2} \le \frac{4(2)(28)}{| -20 |} = \frac{56}{5}} = 11.2\) \quad \quad and \quad \quad \(y^{2} \le \frac{4(3)(28)}{| -20 |} = \frac{84}{5} = 16.8\)
\end{center}
And so
\begin{center}
\(|x| \le 3} \quad \quad and \quad \quad \(|y| \le 4\)
\end{center}
Testing all pairs of \((x, y)\) which satisfy those constraints, we find that the representations of \(28\) by \(f = (3, 2, 2)\) are \((2, 2)\), \((-2, -2)\), \((-2, 4)\), and \((2, -4)\). \(\square\)
\end{example}

\bigskip





\section{Equivalence}

\bigskip

In this section, we'll learn what makes two forms equivalent. If two forms are equivalent then they represent the same integers, although the inverse is not necessarily true. There are two types of equivalence: wide equivalence and proper equivalence.

\bigskip

\theoremstyle{definition}
\begin{definition}[Wide equivalence]
Two forms \(f(x, y) = ax^{2} + bxy + cy^{2}\) and \(g(x, y) = Ax^{2} + Bxy + Cy^{2}\) are widely equivalent if there is an invertible change of variables
\begin{center}
\(x' = r x + s y, \quad y' = t x + u y\)
\end{center}
with \(r , s , t , u \in \mathbb{Z}\) and \(r u - s t = \pm 1\), such that
\begin{center}
\(a(x')^{2} + b x' y' + c (y')^{2} = Ax^{2} + Bxy + Cy^{2}\)
\end{center}
or, in other words, \(g(x, y) = f(rx + sy, tx + uy)\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Proper equivalence]
Two forms \(f(x, y) = ax^{2} + bxy + cy^{2}\) and \(g(x, y) = Ax^{2} + Bxy + Cy^{2}\) are properly equivalent if the wide equivalence conditions hold and also \(r u - s t = +1\).
\end{center}
\end{definition}

\bigskip

Given the above definitions, a change of variables of a wide equivalence relation can be represented by a matrix\footnote{See Appendix 7.1 for definitions of \(GL(2, \mathbb{Z})\) and \(SL(2, \mathbb{Z})\).}
\begin{center}
\(T = \begin{bmatrix} r & s \\ t & u \end{bmatrix} \in GL(2, \mathbb{Z})\)
\end{center}
and a change of variables of a proper equivalence relation can be represented by the matrix
\begin{center}
\(U = \begin{bmatrix} r & s \\ t & u \end{bmatrix} \in SL(2, \mathbb{Z})\)
\end{center}

\bigskip

In either case, we can write
\begin{center}
\(\begin{bmatrix} x' \\ y' \end{bmatrix} = \begin{bmatrix} r & s \\ t & u \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix}\)
\end{center}
to describe the change of variables. The invertibility requirement of the change of variables is what imposes the constraint that \(ru - st = \pm 1\) (in the case of wide equivalence, or \(ru - st = +1\) in the case of proper equivalence) since only those \(2 \times 2\) matrices whose determinant is equal to \(\pm 1\) are invertible.

\bigskip

We'll restrict our discussion to proper equivalence. What follows doesn't necessarily generalize to wide equivalence, and in particular to cases where the matrix is in \(GL(2, \mathbb{Z}) \setminus SL(2, \mathbb{Z})\).

\bigskip

We can express form equivalence and the change of variables using the matrix representation of forms, i.e. \(M(f) = \begin{bmatrix} a & b/2 \\ b/2 & c \end{bmatrix}\).

\bigskip

Suppose that two forms \(f (x, y) = a x^{2} + b xy + c y^{2}\) and \(g (x, y) = A x^{2} + B xy + C y^{2}\) are properly equivalent. Then we have

\bigskip

\begin{center}
\begin{aligned}
\(g(x, y) &= \begin{bmatrix} x & y \end{bmatrix} M(g) \begin{bmatrix} x \\ y \end{bmatrix}\) \\
\(&= \begin{bmatrix} x & y \end{bmatrix} \begin{bmatrix} A & B/2 \\ B/2 & C \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix}\) \\
\(&= \begin{bmatrix} x & y \end{bmatrix} \begin{bmatrix} r & t \\ s & u \end{bmatrix} \begin{bmatrix} a & b/2 \\ b/2 & c \end{bmatrix} \begin{bmatrix} r & s \\ t & u \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix}\) \\
\(&= \begin{bmatrix} x & y \end{bmatrix} \ U^{\top} \ M(f) \ U \begin{bmatrix} x \\ y \end{bmatrix}\) \\
\end{aligned}
\end{center}

\bigskip

Therefore, \(M(g) = U^{\top} \ M(f) \ U\).

\bigskip

Further, observe that
\begin{center}
\(f\left(\begin{bmatrix} r & s \\ t & u \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix}\right) = f ( r x + s y, t x + u y) = a (r x + sy)^{2} + b (rx + sy)(tx + uy) + c (tx + uy)^{2}\)
\end{center}
For ease of notation, define \((fU)(x, y) = f\left(\begin{bmatrix} r & s \\ t & u \end{bmatrix} \begin{bmatrix} x \\ y \end{bmatrix}\right)\), and note that
\begin{center}
\(M(fU) = U^{\top} \ M(f) \ U\)
\end{center}

\bigskip

Then we can state a second definition for proper equivalence as the following.

\bigskip

\theoremstyle{definition}
\begin{definition}[Proper equivalence]
Two forms \(f\) and \(g\) are properly equivalent if \(g = fU\) for some \(U \in SL(2, \mathbb{Z})\). The \(SL(2, \mathbb{Z})\)-orbit of a form is called the proper equivalence class of that form.\footnote{See Appendix 7.2 for discussion on orbits. Essentially, the above sentence means that the proper equivalence class of a form is the set of all forms given by computing \(U^{\top} M(f) \ U\) for all of the \(U \in SL(2, \mathbb{Z})\).}
\end{center}
\end{definition}

\bigskip

Notice that because \(SL(2, \mathbb{Z})\) is a group (and associative under matrix multiplication), equivalence is transitive. To see this, consider three forms \(f(x, y)\), \(g(x,y)\), and \(h(x,y)\), and let \(g = fU\) and \(h = gV\), where \(U, V \in SL(2, \mathbb{Z})\). Then
\begin{center}
\(M(h) = V^{\top} \ M(g) \ V = V^{\top} \ U^{\top} \ M(f) \ U \ V = W^{\top} \ M(f) \ W\)
\end{center}
where \(W = UV \in SL(2, \mathbb{Z})\) and \(W^{\top} = V^{\top} U^{\top} \in SL(2, \mathbb{Z})\). Therefore \(h = fW\), where \(W \in SL(2, \mathbb{Z})\).







\bigskip








\section{The class group}

\bigskip

We can now say a bit more about the connection between ideal class groups and form class groups.

\bigskip

Take a negative discriminant \(\Delta\) and let \(F ( \Delta)\) be the set of primitive positive definite binary quadratic forms \(ax^{2} + b xy + c y^{2}\) whose discriminant is \(\Delta\). Define a proper equivalence relation (we'll call it \(\sim \)) on \(F (\Delta)\) such that \(f \sim g\) when \(g = fU\) for \(U \in SL(2, \mathbb{Z})\). This breaks up \(F (\Delta)\) into a set of equivalence classes, \(C(\Delta) = F(\Delta) / \sim\).

\bigskip

Now consider a quadratic extension field \(K = \mathbb{Q}(\sqrt{d})\), where \(d\) is square-free.\footnote{See Appendix 7.3 for definitions of the following terms in this paragraph: quadratic extension field, ring of integers, fractional ideal, principal fractional ideal, quotient group.} If \(d \equiv 1 \ \textrm{mod} \ 4\), then the discriminant of \(K\) is \(\Delta = d\). Otherwise, the discriminant of \(K\) is \(\Delta = 4d\). Let \(O_{K}\) be the ring of integers of \(K\), and let \(J_{K}\) be the group of fractional ideals of the ring of integers \(O_{K}\). \(P_{K}\) is the subgroup of \(J_{K}\) consisting of principal fractional ideals. We define the ideal class group of \(K\) as the quotient group \(Cl(K) = J_{K} / P_{K}\). % add a reference here to paper on ideal class groups

\bigskip

The connection between the above two types of class groups --- and therefore between binary quadratic forms and ideals in quadratic fields --- involves bijections between special versions of each type of class group, the details of which depend on whether the discriminant in question is positive or negative.\footnote{A bijection is a mapping that is both injective and surjective; in other words, every element in the mapping's codomain is mapped to by exactly one element in the mapping's domain.} For a real quadratic field \(K = \mathbb{Q}(\sqrt{d})\) with discriminant \(\Delta_{K} > 0\), there is a bijection between the narrow ideal class group\footnote{The narrow ideal class group is such that instead of using \(P_{K}\) in our class group quotient group, we use \(P_{K}^{+}\), which is the group of totally positive principal fractional ideals of \(K\).} of \(K\) and the form class group of primitive integral binary quadratic forms of discriminant \(\Delta_{K}\). And for an imaginary quadratic field \(K = \mathbb{Q}(\sqrt{d})\) with discriminant \(\Delta_{K} < 0\), there is a bijection between the ideal class group of \(K\) and the form class group of primitive positive-definite integral binary quadratic forms of discriminant \(\Delta_{K}\).







\bigskip








\section{Reduction}

\bigskip

This section will introduce normal forms and reduced forms and give algorithms for normalization and reduction.

\bigskip

\subsection{Normal forms}

\bigskip

\theoremstyle{definition}
\begin{definition}[Normal form]
A form \(f = (a, b, c)\) is called normal if \(-a < b \le a\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Normalization operator]
We define the normalization operator \(\eta (f)\) as
\begin{center}
\(\eta (f)  = \eta (a, b, c) = (a, b + 2ra, ar^{2} + br + c)\)
\end{center}
where \(r = \left\lfloor \frac{a-b}{2a} \right\rfloor\).
\end{definition}

\bigskip

\subsubsection{Normalization algorithm}

\bigskip

The normalization algorithm, given a form \(f = (a, b, c)\), such that \(\Delta < 0\) and \(a > 0\) is:
\begin{enumerate}
\item Compute \(r = \left\lfloor \frac{a-b}{2a} \right\rfloor\).
\item Compute \(\eta( f)\) and update \(f = \eta(f)\).
\item Return \(f\), which is now normalized.
\end{enumerate}

\bigskip

\theoremstyle{example}
\begin{example}
Let's normalize the form \(f = (11, 49, 55)\). Note that it is not normal because \(b > a\).

\bigskip

First we compute \(r\):
\begin{center}
\(r = \left\lfloor \frac{a-b}{2a} \right\rfloor = \left\lfloor \frac{11 - 49}{2(11)} \right\rfloor = \left\lfloor -1.\overline{72} \right\rfloor = -2\)
\end{center}

Then we compute \(\eta (f) \):
\begin{center}
\(\eta (f) = \eta (a, b, c) = (a, b + 2ra, ar^{2} + br + c) = (11, 49 + 2(-2)(11), 11(-2)^{2} + 49(-2) + 55) = (11, 5, 1)\)
\end{center}

And so the normalization of \(f = (11, 49, 55) \) is \(f_{norm} = (11, 5, 1)\). \(\square\)
\end{example}

\bigskip

\subsection{Reduced forms}

\bigskip

\theoremstyle{definition}
\begin{definition}[Reduced form]
A positive definite form \(f = (a, b, c)\) is called reduced if it is normal and \(a \le c\), and if \(a = c\) then \(b \ge 0\).
\end{definition}

\bigskip

Reduction of forms is important to the Chia VDF because frequently reducing \(f(a, b, c)\) as \(f\) is repeatedly squared keeps \(a\), \(b\), and \(c\) from growing too large.

\bigskip

For any given \(\Delta < 0\), each proper equivalence class of binary quadratic forms of that discriminant contains a unique reduced representative. We can therefore know certain properties of a discriminant, such as its class number, by studying only the reduced forms in the class group of that discriminant.

\bigskip

For a reduced form and \(\Delta < 0\), we have

\begin{center}
\begin{aligned}
\(\, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, |\Delta | &= 4ac - |b|^{2} \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, (\Delta < 0) \\
&\ge 4a (a) - a^{2} \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, \, (-a < b \le a,\ a \le c) \\
&\ge 3a^{2}\)
\end{aligned}
\end{center}

and so

\begin{center}
\(a \le \sqrt{\frac{|\Delta |}{3}}\)
\end{center}

\bigskip

Therefore, for a given \(\Delta < 0\), there are finitely many \(a\), and consequently there are finitely many \(b\) and \(c\).\footnote{Because \(|b| \le a\) and \(c = \left( \frac{b^{2} - \Delta}{4a}\right)\).} This means that negative discriminants have a finite number of reduced forms and therefore have a finite number of equivalence classes.

\bigskip

\theoremstyle{theorem}
\begin{theorem}
Each primitive positive definite form \(f\) is properly equivalent to a unique reduced form.
\end{theorem}

\bigskip

\theoremstyle{definition}
\begin{definition}[Principal form of discriminant \(\Delta\)]
Let \(\Delta\) be a negative integer such that \(\Delta \equiv 0, 1 \ \textrm{mod} \ 4\), i.e. \(\Delta\) is a negative discriminant. Let \(k = \Delta \ \textrm{mod} \ 2\). Then
\begin{center}
\(f = \left(1, k, \frac{k^{2} - \Delta}{4}\right)\)
\end{center}
is the unique reduced form \((1, b, c)\) of discriminant \(\Delta\). This particular reduced form is called the principal form of discriminant \(\Delta\).
\end{definition}

\bigskip

\theoremstyle{example}
\begin{example}
Here are examples of principal forms of several discriminants.
\begin{center}
\(\Delta = -3 \quad (1, 1, 1) \quad \quad \quad \Delta = -4 \quad (1, 0, 1)\) \\
\(\Delta = -7 \quad (1, 1, 2) \quad \quad \quad \Delta = -8 \quad (1, 0, 2)\) \\
\(\Delta = -11 \quad (1, 1, 3) \quad \quad \quad \Delta = -15 \quad (1, 1, 4)\) \\
\(\phantom{\quad \quad \quad \quad \square} \Delta = -19 \quad (1, 1, 5) \quad \quad \quad \Delta = -20 \quad (1, 0, 5) \quad \quad \quad \quad \square\)
\end{center}
\end{example}

\bigskip

\theoremstyle{definition}
\begin{definition}[Principal class of discriminant \(\Delta\)]
The equivalence class of the principal form of discriminant \(\Delta\) is called the principal class of discriminant \(\Delta\).
\end{definition}

\bigskip

The principal class of a discriminant \(\Delta\) is the identity element of the form class group of \(\Delta\) with respect to form composition.\footnote{Form composition is discussed in Section 6.}

\bigskip

\theoremstyle{example}
\begin{example}
Let's consider the discriminant \(\Delta = -23\). This discriminant has a total of three equivalence classes of positive definite binary quadratic forms. Therefore its class number is 3. In particular, the three unique reduced representatives of the equivalence classes are
\begin{center}
\((1, 1, 6), \quad (2, -1, 3), \quad \textrm{and} \quad (2, 1, 3)\).
\end{center}
The principal form is \((1, 1, 6)\), and therefore this form (as a representative of the principal equivalence class) acts as the identity when composed with other forms with \(\Delta = -23\). Every primitive positive definite binary quadratic form with \(\Delta = -23\) is properly equivalent to one of the three forms above, and composition in the group boils down to composition between these three forms. \square
\end{example}

\bigskip

\theoremstyle{definition}
\begin{definition}[Reduction operator]
Given a form \(f = (a, b, c)\), the reduction operator \(\rho (f)\) is defined as
\begin{center}
\(\rho (f) = \rho (a, b, c) = (c, -b + 2sc, cs^{2} - bs + a)\)
\end{center}
where \(s = \left\lfloor \frac{c+b}{2c} \right\rfloor\). Notice that \(\rho (a, b, c)\) is equivalent to the normalization of \((c, -b, a)\).
\end{defintion}

\bigskip

\subsubsection{Reduction algorithm}

\bigskip

The reduction algorithm, given a form \(f = (a, b, c)\) such that \(\Delta < 0\) and \(a > 0\) is:
\begin{enumerate}
\item Normalize \(f\) and update \(f = f_{\textrm{norm}}\).
\item If \(f\) is reduced, return \(f\); if \(f\) is not reduced, compute \(s\) and \(\rho(f)\) and update \(f = \rho(f)\).
\item Repeat step 2 until a reduced form is produced.
\end{enumerate}

\bigskip

\theoremstyle{example}
\begin{example}
Let's reduce the form \(f = (11, 49, 55)\). We first normalize it, which we did in Example 5.1, finding that \(f_{\textrm{norm}} = (11, 5, 1)\). Solving Example 5.1 is equivalent to performing step 1 of the reduction algorithm.

\bigskip

But \(f = f_{norm}\) is not yet reduced because \(a > c\). We implement the reduction operator until we reach a reduced form.

\bigskip

Compute \(s\):
\begin{center}
\(s = \left\lfloor \frac{c+b}{2c} \right\rfloor = \left\lfloor \frac{1+5}{2(1)} \right\rfloor = \left\lfloor 3 \right\rfloor = 3\)
\end{center}

Compute \(\rho(f)\):
\begin{center}
\(\rho(f) = (c, -b + 2sc, cs^{2} - bs + a) = (1, -5 + 2(3)(1), 1(3)^{2} - 5(3) + 11)) = (1, 1, 5)\)
\end{center}

\bigskip

This form is reduced and so \((1, 1, 5)\) is the reduced form of \((11, 49, 55)\). Notice that, of course, the discriminant of all three forms is \(-19\). \(\square\)

\end{example}





\bigskip




\section{Composition}

\bigskip

Originally developed by Gauss, composition of binary quadratic forms is a commutative operation on the class group. Others, such as Arndt, Dirichlet, and Bhargava, have contributed to the topic, and various algorithms have been developed for its implementation. In this section I motivate and outline the details of composition, and then I lay out the basic structure of the algorithm.

\bigskip

\subsection{Explaining composition}

\bigskip

To begin, note that we only perform composition between forms which have the same discriminant. This should make sense because we're operating within the class group of a particular discriminant, and although the objects we're operating on are integer 3-tuples, \((a, b, c)\), which represent binary quadratic forms, the more abstract objects that we're operating on are the equivalence classes of the class group. Analogously, when we add the rational numbers \(\frac{20}{12}\) and \(\frac{5}{35}\), what we're fundamentally working with are the fraction equivalence classes whose ``reduced representatives'' are \(\frac{5}{3}\) and \(\frac{1}{7}\).

\bigskip

To understand the basic idea behind composition, consider two binary quadratic forms
\begin{center}
\(f_{1} = a x_{1}^{2} + b x_{1} y_{1} + c y_{1}^{2} \quad \textrm{and} \quad f_{2} = \alpha x_{2}^{2} + \beta x_{2} y_{2} + \gamma y_{2}^{2}\)
\end{center}
Note that we consider \((x_{1}, y_{1})\) and \((x_{2}, y_{2})\) as independent sets of variables.

\bigskip

We then would like to find a form \(f_{3}\) such that
\begin{center}
\(f_{1} f_{2} = f_{3}\)
\end{center}

\bigskip

Multiplying \(f_{1}\) and \(f_{2}\), we find that
\begin{align*}
f_{1} f_{2} = \, \, & a \alpha x_{1}^{2} x_{2}^{2} + a \beta x_{1}^{2} x_{2} y_{2} + a \gamma x_{1}^{2} y_{2}^{2} + b \alpha x_{1} y_{1} x_{2}^{2} + b \beta x_{1} y_{1} x_{2} y_{2} \\
&+ b \gamma x_{1} y_{1} y_{2}^{2} + c \alpha y_{1}^{2} x_{2}^{2} + c \beta y_{1}^{2} x_{2} y_{2} + c \gamma y_{1}^{2} y_{2}^{2}
\end{align*}

\bigskip

We want the righthand side of the equation to resemble a binary quadratic form so that
\begin{center}
\(f_{1} f_{2} = A X^{2} + B X Y + C Y^{2} = f_{3}\)
\end{center}
for some \(A\), \(B\), \(C \in \mathbb{Z}\).

\bigskip

We'll do this by using a change of variables such that \(X\) and \(Y\) are linear combinations of \(x_{1} x_{2}\), \(x_{1} y_{2}\), \(y_{1} x_{2}\), and \(y_{1} y_{2}\):
\begin{center}
\(X = j x_{1} x_{2} + k x_{1} y_{2} + l y_{1} x_{2} + m y_{1} y_{2}\), \quad \(Y = r x_{1} x_{2} + s x_{1} y_{2} + t y_{1} x_{2} + u y_{1} y_{2}\)
\end{center}
for some \(j, k, l, m, r, s, t, u \in \mathbb{Z}\). The goal of our algorithm is to find \(A\), \(B\), and \(C\) by finding appropriate integer values for \(j, k, l, m, r, s, t, u\).

\bigskip

We find \(j, k, l, m, r, s, t, u\) as follows. Define \(g = \frac{1}{2} (b + \beta)\) and \(h = - \frac{1}{2} (b - \beta)\). Define \(w = \gcd(a, \alpha, g)\). Then define the matrix
\begin{center}
\(M = \begin{pmatrix} j & k & l & m \\ r & s & t & u \end{pmatrix}\)
\end{center}
with submatrices
\begin{center}
\(M_{1} = \begin{pmatrix} j & k \\ r & s \end{pmatrix}, \quad M_{2} = \begin{pmatrix} j & l \\ r & t \end{pmatrix}, \quad M_{3} = \begin{pmatrix} j & m \\ r & u \end{pmatrix}, \\
\bigskip
M_{4} = \begin{pmatrix} k & l \\ s & t \end{pmatrix}, \quad M_{5} = \begin{pmatrix} k & m \\ s & u \end{pmatrix}, \quad M_{6} = \begin{pmatrix} l & m \\ t & u \end{pmatrix}\)
\end{center}

\bigskip

Set the values \(j\), \(r\), \(s\), \(t\), and \(u\) to be
\begin{center}
\(j = w, \quad r = 0, \quad s = \frac{a}{w}, \quad t = \frac{\alpha}{w}, \quad u = \frac{g}{w}\)
\end{center}
and find \(k\), \(l\), and \(m\) using the following set of conditions:
\begin{enumerate}
\item \(\det(M_{4}) = k t - l s = h\)
\item \(\det(M_{5}) = k u - ms = \gamma\)
\item \(\det(M_{6}) = l u - m t = c\)  
\end{enumerate}

\bigskip

To solve this set of equations, we'll create an augmented matrix and row reduce.
\begin{center}
\(\begin{gmatrix}[p] t & -s & 0 & \BAR & h \\ u & 0 & -s & \BAR & \gamma \\ 0 & u & -t & \BAR & c \rowops \swap{1}{2}\end{gmatrix} \quad \Rightarrow \quad \begin{gmatrix}[p] t & -s & 0 & \BAR & h \\ 0 & u & -t & \BAR & c \\ u & 0 & -s & \BAR & \gamma \rowops \mult{0}{\cdot 1/t} \mult{1}{\cdot 1/u} \end{gmatrix}

\smallskip

\Rightarrow \begin{gmatrix}[p] 1 & -s/t & 0 & \BAR & h/t \\ 0 & 1 & -t/u & \BAR & c/u \\ u & 0 & -s & \BAR & \gamma \rowops \add[s/t]{1}{0} \end{gmatrix} \quad \Rightarrow \quad \begin{gmatrix}[p] 1 & 0 & -s/u & \BAR & (hu + cs)/tu \\ 0 & 1 & -t/u & \BAR & c/u \\ u & 0 & -s & \BAR & \gamma \rowops \add[-u]{0}{2} \end{gmatrix}

\smallskip

\Rightarrow \begin{gmatrix}[p] 1 & 0 & -s/u & \BAR & (hu + cs)/tu \\ 0 & 1 & -t/u & \BAR & c/u \\ 0 & 0 & 0 & \BAR & \gamma - (hu+cs)/t \end{gmatrix}\)
\end{center}

\bigskip

In order for this matrix to have solutions, it must be the case that \(\gamma - (hu+cs)/t = 0\).\footnote{Note that because the reduced binary quadratic forms relevant to Chia are positive definite forms, \(a > 0\), and so \(t \ne 0\).} Let's check to see if \(\gamma - \frac{hu+cs}{t} \stackrel{?}{=} 0\):
\begin{align*}
\gamma - \frac{hu+cs}{t} &= \gamma - \frac{h\frac{g}{w}+c\frac{a}{w}}{\frac{\alpha}{w}} \\
&= \gamma - \frac{gh+ac}{\alpha} \\
& = \gamma - \frac{\left(\frac{1}{2}(b + \beta) \right) \left( -\frac{1}{2} (b - \beta) \right) + ac}{\alpha} \\
&= \gamma - \frac{\left(-\frac{1}{4} b^{2} + \frac{1}{4} \beta^{2} \right) + ac}{\alpha} \\
&= \frac{1}{\alpha} \left( \alpha \gamma + \frac{1}{4} b^{2} - \frac{1}{4} \beta^{2} - ac \right) \\
&= \frac{1}{4 \alpha} \left( 4 \alpha \gamma + b^{2} - \beta^{2} - 4ac \right)\\
&= \frac{1}{4 \alpha} \left( \left( b^{2} - 4ac \right) - \left( \beta^{2} - 4 \alpha \gamma \right) \right)\\
&= \frac{1}{4 \alpha} \left( 0 \right) \quad \quad \textrm{[ because \(\Delta(f_{1}) = \Delta(f_{2})\) ]}\\
&= 0 \quad \checkmark
\end{align*}

\bigskip

Therefore, our row-reduced matrix is
\begin{center}
\(\begin{gmatrix}[p] 1 & 0 & -s/u & \BAR & (hu + cs)/tu \\ 0 & 1 & -t/u & \BAR & c/u \\ 0 & 0 & 0 & \BAR & 0 \end{gmatrix}\)
\end{center}

\bigskip

This matrix corresponds to the following system of equations:
\begin{center}
\begin{enumerate}
\item \(k -\frac{s}{u}m = \frac{hu + cs}{tu}\)
\item \(l -\frac{t}{u}m = \frac{c}{u}\)
\item \(0 = 0\)
\end{enumerate}
\end{center}

\bigskip

We can parameterize the system, with \(\xi\) as the parameter, and we find that the system has infinite solutions of the following form:
\begin{center}
\(k = \frac{s}{u} \xi + \frac{hu + cs}{tu}, \quad \quad l = \frac{t}{u} \xi + \frac{c}{u}, \quad \quad \textrm{and} \quad \quad m = \xi\)
\end{center}

\bigskip

We need to choose a form of \(\xi\) such that \(k\), \(l\), and \(m\) are integers.

\bigskip

Putting \(\xi\) in terms of \(k\), we have
\begin{center}
\(\xi = \frac{tuk - hu - cs}{st}\)
\end{center}

\bigskip

To ensure that the fraction on the righthand side is an integer, we solve the congruence\footnote{See Appendix 7.4 for one method of solving an congruence of this form.}
\begin{center}
\((tu)k \equiv hu + sc \quad \textrm{mod} \ st\)
\end{center}
which produces a set of solutions of the form \(k = \mu + \nu n\), where \(\mu, \nu \in \mathbb{Z}\) and \(n\) ranges over all of \(\mathbb{Z}\). Any choice of \(n\) will yield integer values for \(k\) and \(m\), but some \(n\) values may produce a non-integer value for \(l\), so we now find an appropriate \(n\) value that guarantees \(l \in \mathbb{Z}\). Putting \(l\) in terms of \(n\), we have
\begin{center}
\(l = \frac{t}{u} \xi + \frac{c}{u} = \frac{tk - h}{s} = \frac{t(\mu + \nu n) - h}{s} = \frac{(t\nu)n + (t\mu - h)}{s}\)
\end{center}

\bigskip

We want the fraction on the righthand side to equal an integer, so we solve the congruence
\begin{center}
\((t\nu)n \equiv h - t\mu \quad \textrm{mod} \ s\)
\end{center}
which gives a set of solutions of the form \(n = \lambda + \sigma n'\), where \(\lambda, \sigma \in \mathbb{Z}\) and \(n'\) ranges over all of \(\mathbb{Z}\). We choose \(n' = 0\) and let \(n = \lambda\).

\bigskip

We can now find \(k\), \(l\), and \(m\) by
\begin{center}
\(k = \mu + \nu \lambda \quad \quad l = \frac{kt - h}{s} \quad \quad m = \frac{tuk - hu - cs}{st}\)
\end{center}
and these values are guaranteed to be integers. Notice that because \(s = \frac{a}{w}\) and \(t = \frac{\alpha}{w}\), and because \(a\) and \(\alpha\) are never equal to \(0\), it will always be the case that \(s, t \ne 0\), and so \(k\), \(l\), and \(m\) will always be defined.

\bigskip

Finally, \(f_{3} = A X^{2} + B X Y + C Y^{2}\) is given by\footnote{Although \(r = 0\), I'm presenting these formulae with the \(r\) terms to gesture to their inherent symmetry.}
\begin{center}
\(A = s t - r u, \quad \quad B = (j u + m r) - (k t + l s), \quad \quad C = k l - j m\)
\end{center}

\bigskip

To verify that \(f_{3}\) indeed equals \(f_{1} f_{2}\), first expand \(f_{3}\) using \(X = j x_{1} x_{2} + k x_{1} y_{2} + l y_{1} x_{2} + m y_{1} y_{2}\) and \(Y = r x_{1} x_{2} + s x_{1} y_{2} + t y_{1} x_{2} + u y_{1} y_{2}\). After grouping together common terms, we end up with:
\begin{align*}
f_{3} = \, \, & (A j^{2} + B j r + C r^{2}) x_{1}^{2} x_{2}^{2} + (2 A j k + B (j s + k r) + 2 C r s) x_{1}^{2} x_{2} y_{2} \\
& + (A k^{2} + B k s + C s^{2}) x_{1}^{2} y_{2}^{2} + (2 A j l + B (j t + l r) + 2 C r t) x_{1} y_{1} x_{2}^{2} \\
&+ (2 A (j m + k l) + B ( j u + k t + l s + m r) + 2 C (r u + s t)) x_{1} y_{1} x_{2} y_{2} \\
&+ (2 A k m + B (k u + m s) + 2 C s u) x_{1} y_{1} y_{2}^{2} + (A l^{2} + B l t + C t^{2}) y_{1}^{2} x_{2}^{2} \\
&+ (2 A l m + B (l u + m t) + 2 C t u) y_{1}^{2} x_{2} y_{2} + (A m^{2} + B m u + C u^{2}) y_{1}^{2} y_{2}^{2}
\end{align*}

\bigskip

We then wish to check that the above expansion of \(f_{3}\) is equal to
\begin{align*}
f_{1} f_{2} = \, \, & a \alpha x_{1}^{2} x_{2}^{2} + a \beta x_{1}^{2} x_{2} y_{2} + a \gamma x_{1}^{2} y_{2}^{2} + b \alpha x_{1} y_{1} x_{2}^{2} + b \beta x_{1} y_{1} x_{2} y_{2} \\
&+ b \gamma x_{1} y_{1} y_{2}^{2} + c \alpha y_{1}^{2} x_{2}^{2} + c \beta y_{1}^{2} x_{2} y_{2} + c \gamma y_{1}^{2} y_{2}^{2}
\end{align*}

\bigskip

The reader may check for coefficient equality for all terms, but here I will confirm coefficient equality for two of the terms:
\begin{enumerate}
\item \((A j^{2} + B j r + C r^{2}) x_{1}^{2} x_{2}^{2} \stackrel{?}{=} a \alpha x_{1}^{2} x_{2}^{2} \Rightarrow A j^{2} + B j r + C r^{2} \stackrel{?}{=} a \alpha\)
\item \((2 A l m + B (l u + m t) + 2 C t u) y_{1}^{2} x_{2} y_{2} \stackrel{?}{=} c \beta y_{1}^{2} x_{2} y_{2} \Rightarrow 2 A l m + B (l u + m t) + 2 C t u \stackrel{?}{=} c \beta\)
\end{enumerate}

\bigskip

We'll draw from the definitions for \(A\), \(B\), \(C\), \(g\), \(h\), \(w\), \(j\), \(r\), \(s\), \(t\), and \(u\), and from the identities defined by the three conditions on \(k\), \(l\), and \(m\).

\bigskip

To check the first equality, \(A j^{2} + B j r + C r^{2} \stackrel{?}{=} a \alpha\):
\begin{align*}
A j^{2} + B j r + C r^{2} &= (s t - r u) j^{2} + ((j u + m r) - (k t + l s)) j r + (k l - j m) r^{2} \\
&= (s t - 0) j^{2} + ((j u + m r) - (k t + l s)) 0 + (k l - j m) 0 \\
& = s t j^{2} \\
&= \frac{a}{w} \frac{\alpha}{w} w^{2} \\
&= a \alpha \quad \checkmark
\end{align*}

\bigskip

To check the second equality, \(2 A l m + B (l u + m t) + 2 C t u \stackrel{?}{=} c \beta\):
\begin{align*}
2 A l m + B (l u + m t) + 2 C t u &= 2 (s t - r u) l m + ((j u  + m r) - (k t + l s)) (l u + m t) + 2 (k l - j m) t u \\
&= 2lmst - 2lmru + jlu^{2} + jmtu + lmru + m^{2}rt - kltu - kmt^{2} \\
&\phantom{=l} - l^{2}su - lmst + 2kltu - 2jmtu \\
&= lmst - lmru + jlu^{2} + lmru + m^{2}rt - kmt^{2} - l^{2}su + kltu - jmtu \\
&= lmst - 0 + jlu^{2} + 0 + 0 - kmt^{2} - l^{2}su + kltu - jmtu \\
&= lmst + jlu^{2} - kmt^{2} - l^{2}su + kltu - jmtu \\
&= (kltu - kmt^{2} - l^{2}su + lmst) + jlu^{2} - jmtu \\
&= (kt - ls) (lu - mt) + jlu^{2} - jmtu \\
&= (kt - ls) (lu - mt) + j u (lu - mt) \\
&= (kt - ls) c + ju c \\
&= hc + ju c\\
&= hc + w \frac{g}{w} c\\
&= c(h + g)\\
&= c \left(\frac{1}{2} (b + \beta) - \frac{1}{2} (b - \beta)\right) \\
&= c \beta \quad \checkmark
\end{align*}

\bigskip

The reader may similarly verify the equality of the other coefficients, and therefore we confirm that \(f_{3} = f_{1} f_{2}\).

\bigskip

There are several notes to make about this construction.

\bigskip

The first, and most important, is that the system of equations defining \(k, l, \textrm{and } m\) has infinite solutions. However, all of the solutions are in the same equivalence class, and they will each reduce to the same binary quadratic form.
\bigskip

Second, we have the observation that if we wish to reconstruct \(f_{1}\) and \(f_{2}\) from \(g\), \(h\), \(w\), \(j\), \(k\), \(l\), \(m\), \(r\), \(s\), \(t\), and \(u\), we simply note that \(\det(M_{1})\) and \(\det(M_{2})\) recover \(a\) and \(\alpha\) respectively, \(\det(M_{3}) - \det(M_{4})\) and \(\det(M_{3}) + \det(M_{4})\) recover \(b\) and \(\beta\) respectively, and \(\det(M_{6})\) and \(\det(M_{5})\) recover \(c\) and \(\gamma\) respectively.\footnote{Note that recovering \(b\), \(\beta\), \(c\), and \(\gamma\) uses the three conditions on \(k\), \(l\), and \(m\)} So \(f_{1}\) and \(f_{2}\) can be represented using the determinants of the six submatrices of \(M\):
\begin{align*}
f_{1} &= a x_{1}^{2} + b x_{1} y_{1} + c y_{1}^{2} \\
&= (j s - k r) x_{1}^{2} + ( (j u - m r) - (k t - l s) ) x_{1} y_{1} + (l u - m t) y_{1}^{2} \\
&= \det(M_{1})\, x_{1}^{2} + ( \det(M_{3}) - \det(M_{4}) )\, x_{1} y_{1} + \det(M_{6})\, y_{1}^{2} \\
f_{2} &= \alpha x_{2}^{2} + \beta x_{2} y_{2} + \gamma y_{2}^{2} \\
&= (j t - l r) x_{2}^{2} + ( (j u - m r) + (k t - l s) ) x_{2} y_{2} + (k u - m s) y_{2}^{2} \\
&= \det(M_{2})\, x_{2}^{2} + ( \det(M_{3}) + \det(M_{4}) )\, x_{2} y_{2} + \det(M_{5})\, y_{2}^{2}
\end{align*}

\bigskip

\subsubsection{The composition algorithm}

\bigskip

Given \(f_{1} = (a, b, c)\) and \(f_{2} = (\alpha, \beta, \gamma)\), the composition algorithm for \(f_{1} f_{2} = f_{3}\) is as follows:
\begin{enumerate}
\item Set \(g = \frac{1}{2} (b + \beta)\), \(h = - \frac{1}{2} (b - \beta)\), and \(w = \gcd(a, \alpha, g)\).
\item Set \(j = w, \quad r = 0, \quad s = \frac{a}{w}, \quad t = \frac{\alpha}{w}, \quad u = \frac{g}{w}\).
\item Solve \((tu)k = hu + sc \, \, \textrm{mod} \ st\), the solutions to which have the form \(k = \mu + \nu n\) for all \(n \in \mathbb{Z}\). Store \(\mu\) and \(\nu\).
\item Solve \((t\nu)n = h - t\mu \, \, \textrm{mod} \ s\), the solutions to which have the form \(n = \lambda + \sigma n'\) for all \(n' \in \mathbb{Z}\). Store \(\lambda\).
\item Set \(k = \mu + \nu \lambda\), \(l = \frac{kt - h}{s}\), and \(m = \frac{tuk - hu - cs}{st}\).
\item Set \(A = s t - r u\), \(B = (j u + m r) - (k t + l s)\), and \(C = k l - j m\). Then \(f_{3} = (A, B, C)\).
\end{enumerate}






\bigskip

\subsection{Composition and representation of integers}

\bigskip

Consider a composition
\begin{center}
\(f_{1} f_{2} = f_{3}\)
\end{center}
where
\begin{center}
\(f_{1} = a x_{1}^{2} + b x_{1} y_{1} + c y_{1}^{2}, \quad f_{2} = \alpha x_{2}^{2} + \beta x_{2} y_{2} + \gamma y_{2}^{2}, \quad \textrm{and} \quad f_{3} = AX^{2} + BXY + CY^{2}\)
\end{center}

\bigskip

In Section 2.3, we saw that a binary quadratic form represents certain integers, and a representation of an integer \(n\) by a form \(f\) is a solution \((x, y) \in \mathbb{Z}^{2}\) to the equation
\begin{center}
\(ax^{2} + bxy + cy^{2} = n\)
\end{center}

\bigskip

Recall that if two forms are equivalent then they represent the same integers. If \(f_{3,nr}\) is the non-reduced form found by composing \(f_{1}\) and \(f_{2}\) using the algorithm in section 6.1.1, and if, for a given \((x_{1}, y_{1})\) and \((x_{2}, y_{2})\), \(f_{1} (x_{1}, y_{1}) = n_{1}\) and \(f_{2} (x_{2}, y_{2}) = n_{2}\), and if \(X, Y\) are defined as they were in section 6.1, then \(f_{3,nr} (X, Y) = n_{1} n_{2}\). Note that this is not necessarily true for the reduced form \(f_{3,r}\), which is found by submitting \(f_{3,nr}\) to the reduction algorithm. However, \(n_{1} n_{2}\) will be representable by \(f_{3,r}\) under some different set of integers \((X', Y')\) because \(f_{3,nr}\) and \(f_{3,r}\) are in the same equivalence class and therefore represent the same set of integers.

\bigskip






\newpage

\section{Appendix}

\bigskip

\subsection{Special matrices}

\bigskip

\(GL(2, \mathbb{Z})\) is the set of all invertible \(2 \times 2\) matrices with integer entries whose determinants are equal to \(\pm 1\).

\bigskip

\(SL(2, \mathbb{Z})\) is a subgroup of \(GL(2, \mathbb{Z})\) defined as the set of all \(2 \times 2\) matrices with integer entries whose determinants are equal to \(1\). The two generating matrices of \(SL(2, \mathbb{Z})\) are
\begin{center}
\(S = \begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}\) \quad and \quad \(T = \begin{bmatrix} 1 & 1 \\ 0 & 1 \end{bmatrix}\).
\end{center}

\bigskip

\subsection{Orbits}

\bigskip

Let \(S\) be a non-empty set and let \(G\) be a group. A \textit{left action} of \(G\) on \(S\) is a mapping
\begin{center}
\(G \times S \rightarrow S, \quad (g, s) \mapsto gs \in S\)
\end{center}
which has the following properties:
\begin{itemize}
\item \(1_{G} s = s\) for all \(s \in S\)
\item for \(g, h \in G\) and \(s \in S\), \(g(hs) = (gh)s\)
\end{itemize}

\bigskip

Given a left action of \(G\) on \(S\), two elements \(s\) and \(t\) in \(S\) are equivalent if there's an element \(g \ \in G\) such that \(t = gs\). This is an equivalence relation on \(S\), and the equivalence class \(\{gs : g \in G \}\) is called the \(G\)-orbit of \(s\).

\bigskip

We have an analogous definition for a \textit{right action} of a group \(G\) on a set \(S\). Given a right action of \(G\) on \(S\) we define the \(G\)-orbit of \(s\) in the same way as with left actions.

\bigskip

Orbits should bring to mind ring ideals, gesturing toward the deep connection between ideal class groups and form class groups.

\bigskip

\subsection{Ideal class group definitions}

\bigskip

Here are various definitions relating to the content about ideal class groups in Section 4. This information is included to acknowledge the relationship between ideal class groups and form class groups, and to satisfy those curious about the topic, but an understanding of this material is not needed for implementing class group composition of binary quadratic forms.

\bigskip

\theoremstyle{definition}
\begin{definition}[Quadratic extension field]
A quadratic extension field is an extension \(F(\sqrt{z})\) of a field \(F\) such that \(z\) is the root of some irreducible quadratic equation whose coefficients are in \(F\).
\end{definition}

\bigskip

Here we are particularly concerned with quadratic extension fields which are finite field extensions of the rational numbers \(\mathbb{Q}\) --- these are called algebraic extension fields. In other words, they are finite dimensional fields when taken as vector spaces over Q.


\bigskip

\theoremstyle{definition}
\begin{definition}[Ring of integers]
The ring of integers of an algebraic number field \(K\) is the set of elements in \(K\) which are roots of monic polynomials with integer coefficients.
\end{definition}

\bigskip

Examples of rings of integers:
\begin{itemize}
\item For \(K = \mathbb{Q}(i)\), where \(i = \sqrt{-1}\), the ring of integers of \(K\) is \(O_{K} = \{a + b i \ | \ a, b \in \mathbb{Z} \} \).
\item In general, for \(K = \mathbb{Q}(\sqrt{d})\), if \(d \equiv 1 \ \textrm{mod} \ 4\), then \(O_{K} = \{ a + b \frac{1 + \sqrt{d}}{2} \ | \ a, b \in \mathbb{Z} \} \), and if \(d \equiv 2, 3 \ \textrm{mod} \ 4\), then \(O_{K} = \{ a + b \sqrt{d} \ | \ a, b \in \mathbb{Z} \} \).
\end{itemize}

\bigskip

\theoremstyle{definition}
\begin{definition}[Ideal]
An ideal \(I\) of a ring \(R\) is an additive subgroup of \(R\) which multiplicatively absorbs all elements in \(R\) which are outside of \(I\). In other words, for every \(x \in R\) and \(y \in I\), \(xy \in I\) and \(yx \in I\).
\end{definition}

\bigskip

Examples of ideals:
\begin{itemize}
\item In the ring \(\mathbb{Z}\), the ideals of \(\mathbb{Z}\) have the form \(n\mathbb{Z}\) for \(n \in \mathbb{Z}\).
\item In \(\mathbb{Z}_{6}\) (i.e. the integers modulo \(6\)), the set \(I = \{ 0, 2, 4 \}\) is an ideal.
\end{itemize}

\bigskip

\theoremstyle{definition}
\begin{definition}[Principal ideal]
An ideal \(I\) of a ring \(R\) is called a (right) principal ideal if there is an element \(a \in R\) such that \(I = aR = \{ ar \ | \ r \in R \}\). In other words, the ideal is generated by the element \(a\)\). If \(R\) is non-commutative, then \(R\) can have left principal ideals, right principal ideals, or two-sided principal ideals, given by (respectively):
\begin{itemize}
\item \(Ra = \{ ra \ | \ r \in R \} \)
\item \(aR = \{ ar \ | \ r \in R \} \)
\item \(RaR = \{ r_{1} a s_{1} + . . . + r_{n} a s_{n} \ | \ r_{1}, s_{1}, . . . , r_{n}, s_{n} \in R \} \)
\end{itemize}
If \(R\) is commutative then the three above definitions are equivalent. All rings have principal ideals.
\end{definition}

\bigskip

Examples of principal ideals:
\begin{itemize}
\item The set of even integers, \(2\mathbb{Z}\), is a principal ideal of \(\mathbb{Z}\) generated by \(\pm 2\).
\item In fact, every ideal of the ring of integers \(\mathbb{Z}\) is a principal ideal.
\item In the ring \(\mathbb{Z}(\sqrt{-3}) = \{ a + b \sqrt{-3} \ | \ a,b \in \mathbb{Z} \} \), the ideal generated by \(\sqrt{-3}\) is a principal ideal.
\end{itemize}

\bigskip

To define fractional ideals, I must first explain modules.

\bigskip

\theoremstyle{definition}
\begin{definition}[Module]
A module \(M\) over a ring \(R\) is a generalization of a vector space over a field, with the ring elements playing the role of the field scalars. A left \(R\)-module, \(M\), is an abelian group \((M, +)\) with a scalar multiplication operation \(* : R \times M \rightarrow M\) which satisfies the following conditions for all \(r, s \in R\) and \(m, n \in M\):
\begin{itemize}
\item \(r * (m + n) = r * m + r * n\)
\item \((r + s) * m = r * m + s * m\)
\item \((rs) * m = r * (s * m)\)
\item \(1_{R} * m = m\)
\end{itemize}
A right \(R\)-module is the same as above except the ring \(R\) acts on the righthand side of the module instead of on the lefthand side. If \(R\) is commutative, then the left and right \(R\)-modules are the same and the module is simply called an \(R\)-module.
\end{definition}

\bigskip

Examples of modules:
\begin{itemize}
\item For a field \(F\), the concepts of a vector space over \(F\) and an \(F\)-module are identical.
\item Any ideal \(I\) of a ring \(R\) is an \(R\)-module.
\end{itemize}

\bigskip

\theoremstyle{definition}
\begin{definition}[Submodule]
If \(M\) is a module of a ring \(R\), and \(S\) is a subgroup of \(M\), then \(S\) is an \(R\)-submodule if for any \(s \in S\) and any \(r \in R\), the product \(r * s\) is in \(S\) (for a left \(R\)-submodule) or the product \(s * r\) is in \(S\) (for a right \(R\)-submodule).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Fractional ideal]
Let \(K\) be an algebraic number field with ring of integers \(O_{K}\), and let \(T_{K}\) be some subset of \(K\). \(T_{K}\) is a fractional ideal of \(O_{K}\) if it is a finitely-generated \(O_{K}\)-module such that there exists some nonzero \(r \in O_{K}\) where for all \(t \in T_{K}\), \(r t \in O_{K}\). Moreover, the set \(T'_{K} = r T_{K}\) is an ideal of \(O_{K}\), and \(T_{K} = r^{-1} T'_{K}\).
\end{definition}

\bigskip

The element \(r\) can be thought of as ``clearing the denominator'' of all the elements in \(T_{K}\) to produce elements in \(O_{K}\).

\bigskip

Examples of fractional ideals:
\begin{itemize}
\item Consider the algebraic number field \(\mathbb{Q}\) with ring of integers \(\mathbb{Z}\). The subset of \(\mathbb{Q}\) defined by \\ \(I = \{ . . . , -\frac{15}{7}, -\frac{10}{7}, -\frac{5}{7}, 0, \frac{5}{7}, \frac{10}{7}, \frac{15}{7}, . . . \}\) is a fractional ideal of \(\mathbb{Z}\), with \(\pm 7 \in \mathbb{Z}\) being the element which clears the denominator such that for all \(t \in T_{K}\), \(7t \in \mathbb{Z}\).
\item In general, fractional ideals in \(\mathbb{Q}\) have the form \(\{ r \mathbb{Z} \ | \ r \in \mathbb{Q} \}\).
\item The set \(\mathbb{Q}\) is not a fractional ideal because its elements can have arbitrarily large denominators.
\end{itemize}

\bigskip

\theoremstyle{definition}
\begin{definition}[Principal fractional ideal]
Given an algebraic number field \(K\) and its ring of integers \(O_{K}\), a principal fractional ideal is a fractional ideal generated by a single element \(k \in K\) such that the principal fractional ideal is the set \(\{k a \ | \ a \in O_{K} \} \).
\end{definition}

\bigskip

Given an algebraic number field, \(K\), the set of principal fractional ideals, \(P_{K}\), is a subgroup of the group of fractional ideals, \(J_{K}\).

\bigskip

To define quotient groups, I must first explain cosets.

\bigskip

\theoremstyle{definition}
\begin{definition}[Right coset of a subgroup in a group]
Let \(S\) be a subgroup of a group \(G\). Let \(s \in S\), and \(g \in G\). The congruence class of \(g\) modulo \(S\), i.e. \(Sg = \{ sg \ | \ s \in S\}\), is the right coset of \(S\) in \(G\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Left coset of a subgroup in a group]
Let \(S\) be a subgroup of a group \(G\). Let \(s \in S\), and \(g \in G\). \(gS = \{ gs \ | \ s \in S\}\) is the left coset of \(S\) in \(G\).
\end{definition}

\bigskip

\theoremstyle{definition}
\begin{definition}[Quotient group]
Let \(N\) be a normal subgroup of a group \(G\). Then \(G/N\) is the quotient group of \(G\) by \(N\), and it denotes the set of all right cosets of \(N\) in \(G\). The operation on the group is defined as \((Na)(Nb) = Nab\).\footnote{Note that because \(N\) is normal, we could have equivalently defined \(G/N\) to be the set of all left cosets of \(N\) in \(G\).}
\end{definition}

\bigskip

One can think of quotient groups as grouping together similar elements of a larger group into equivalence classes.

\bigskip

Examples of quotient groups:
\begin{itemize}
\item Let \(G\) be the integers modulo 6 under addition, i.e. \(G = \{ 0, 1, 2, 3, 4, 5 \}\), and let \(N\) be the subgroup \(\{ 0, 3 \}\), noting that \(N\) is normal because \(G\) is abelian. \(G/N = \{g + N \ | \ g \in G \} = \{ \{0,3\}, \{1,4\}, \{2,5\} \} = \{ 0 + N, 1 + N, 2 + N \}\).
\item Let \(G = \mathbb{Z}\) and \(N = 2\mathbb{Z}\), i.e. \(G\) is the set of integers and \(N\) is the set of even integers. \(N\) is a normal subgroup because \(G\) is abelian. \(G/N = \{ 2\mathbb{Z}, 2\mathbb{Z} + 1 \}\), with the two cosets being the even and odd integers, respectively.
\end{itemize}

\bigskip

\subsection{Solving linear congruences}

\bigskip

In this section, I will outline one way of solving linear congruences of the form \(ax \equiv b \ \textrm{mod} \ m\).

\bigskip

First, using the extended Euclidean algorithm, we may find integers \(d\), \(e\), and \(g\) such that
\begin{center}
\(g = \gcd(a, m) \quad \quad \textrm{and} \quad \quad da + em = g\)
\end{center}

\bigskip

Then note the following theorem:

\bigskip

\theoremstyle{theorem}
\begin{theorem}
The congruence \(ax \equiv b \ \textrm{mod} \ m\) has a solution if and only if \(\gcd(a, m)\) divides \(b\).
\end{theorem}

\bigskip

If the linear congruence \(ax \equiv b \ \textrm{mod} \ m\) has a solution, then by Theorem 7.1 there exists some \(q \in \mathbb{Z}\) such that \(qg = b\). Therefore we have
\begin{center}
\(da + em = g \quad \Rightarrow \quad qda + qem = qg \quad \Rightarrow \quad qda + qem = b\)
\end{center}

\bigskip

Taking the last equation \(\textrm{mod} \ m\), we have
\begin{center}
\(aqd \equiv b \ \textrm{mod} \ m\)
\end{center}

\bigskip

Therefore \(qd\) is one solution to the congruence relation. However, the congruence \(ax \equiv b \ \textrm{mod} \ m\) has an infinite set of solutions of the form \(k = \mu + \nu n\), where \(\mu\) is \(qd \ \textrm{mod} \ m\), \(\nu = \frac{m}{g}\), and \(n\) ranges over all of \(\mathbb{Z}\). To check these solutions, first note that because \(g = \gcd(a, m)\), \(g\) divides \(a\) and so there exists some \(w \in \mathbb{Z}\) such that \(a = wg\). Then
\begin{center}
\begin{aligned}
ax &= a(qd + \frac{m}{g} n) \\
&= aqd + a \frac{m}{g} n \\
&= aqd + wmn \\
&\equiv b \ \textrm{mod} \ m \quad \checkmark\\
\end{aligned}
\end{center}

\bigskip

\subsubsection{Linear congruence algorithm}

\bigskip

The following is an example algorithm for solving a linear congruence of the form \(ax \equiv b \ \textrm{mod} \ m\):

\begin{enumerate}
\item Use the extended Euclidean algorithm to find \(g\), \(d\), \(e\), where \(g = \gcd(a, m)\) and \(da + em = g\).
\item Set \(q = \left\lfloor \frac{b}{g} \right\rfloor\), and set \(r = b \ \% \ g\).
\item If \(r \ne 0\), return ``The congruence has no solution.'' End algorithm.
\item Else set \(\mu = \(qd \ \% \ m\), and set \(\nu = \frac{m}{g}\).
\end{enumerate}

\bigskip

The set of solutions of the linear congruence then have the form \(k = \mu + \nu n\), where \(n\) ranges over all of \(\mathbb{Z}\).








\newpage






\section*{References}

\bigskip
\bigskip

Buchmann, J. and Vollmer, U. (2007). \textit{Binary quadratic forms: An algorithmic approach}. (Vol. 20, Algorithms and computation in mathematics). Berlin: Springer-Verlag.

\bigskip

Cohen, H. (1993). \texit{A course in computational algebraic number theory}. (Vol. 138, Graduate texts in mathematics). Berlin: Springer-Verlag.

\bigskip

Granville, A. (2014). Composing quadratic forms: Gauss, Dirichlet and Bhargava. \textit{Pi in the Sky}, \textbf{18}, 3-6.

\bigskip

Jacobson, M. J. and van der Poorten, A. J. (2002). Computational aspects of NUCOMP. \textit{Lecture notes in computer science}, \textit{Algorithmic number theory - ANTS-V}, vol. 2369, 120-133. doi:10.1007/3-540-45455-1\_10

\bigskip

Jenkins, E. D. (1935). On the composition of quadratic forms. \textit{Bulletin of the American Mathematical Society}, vol. 41, number 10, 719-726.










\end{document}